{% extends 'main/base.html' %}
{% block content %}
<h1>Upload files</h1>

<h4>{{ error }}</h4>
<form action="{% url "main:upload_json_en" %}" method="POST" enctype="multipart/form-data" class="form-horizontal">
{% csrf_token %}
<div class="progress">
  <div id="progress-bar" class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="50"
  aria-valuemin="0" aria-valuemax="100" style="width:0%">
  </div>
</div>
<div class="form-group">
    <label for="name" class="col-md-3 col-sm-3 col-xs-12 control-label">English file: </label>
    <div class="col-md-8">
        <input type="file" name="json_file_en" id="json_file_en" required="True" class="form-control">
    </div>
</div>

<div class="form-group">
    <div class="col-md-3 col-sm-3 col-xs-12 col-md-offset-3" style="margin-bottom:10px;">
         <button class="btn btn-primary"> <span class="glyphicon glyphicon-upload" style="margin-right:5px;"></span>Upload </button>
    </div>
</div>
</form>

<form action="{% url 'main:upload_json_es' %}" method="POST" enctype="multipart/form-data" class="form-horizontal">
{% csrf_token %}
<div class="form-group">
    <label for='name' class="col-md-3 col-sm-3 col-xs-12 control-label">Spanish file: </label>
    <div class="col-md-8">
        <input type="file" name="json_file_es" id="json_file_es" required="True" class="form-control">
    </div>
</div>
<div class="form-group">
    <div class="col-md-3 col-sm-3 col-xs-12 col-md-offset-3" style="margin-bottom:10px;">
         <button class="btn btn-primary"> <span class="glyphicon glyphicon-upload" style="margin-right:5px;"></span>Upload </button>
    </div>
</div>
</form>
<script>
    taskId = "{{ task_id }}";
    if (taskId != "" ){
        intervalId = window.setInterval(function(){
        request = $.ajax({
            url: "get_progress",
            type: "GET",
            data: {task_id : taskId},
            dataType: "json",
            success: function (data) {
                    updateProgressBar(data)
                    if (data.state == "DONE"){
                        clearInterval(intervalId);
                    }
                },
            error: function (xhr, status, errorThrown) {
                clearInterval(intervalId);
            }
            });
        }, 500);
    }

    function updateProgressBar(data){
    progressBar = document.getElementById("progress-bar");
    if (data.state == "PROGRESS"){
        current = data.details.current
        total = data.details.total
        progressBar.style.width = Math.ceil((current / total) * 100) + "%";
    }
    else if (data.state == "SUCCESS"){
        progressBar.style.width = "100%";
    }
    }
</script>
{% endblock %}